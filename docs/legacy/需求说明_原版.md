# 项目规格说明书（MVP）

项目代号：**Talk2Report**
产品名称（暂定）：**Talk2Report｜智能访谈助手**
版本：MVP v0.1
目标用户：职场人士（述职/年终总结/复盘/经验分享）
核心价值：将隐性经验通过“结构化访谈”转化为可交付文本

---

## 1. 产品目标与范围

### 1.1 MVP 目标（必须实现）

用户在 10–15 分钟内完成智能访谈（12 问 + AI 动态追问），系统输出 4 份可交付稿件：

1. **200 字精简版**（可发群/朋友圈/简报）
2. **800–1500 字正式稿**（上交材料/述职稿）
3. **结构化大纲**（可编辑、可复用）
4. **PPT 提纲**（10 页以内，页标题+要点）

**核心机制**：
- AI 根据回答质量智能追问（补充细节、挖掘证据）
- 结构化抽取（防止编造事实）
- 反套话生成（压制空洞表述）

### 1.2 MVP 不做（明确排除）

* 不做实时全双工语音对话（电话式）
* 不做登录/支付/团队协作
* 不做复杂模板市场、范文检索
* 不做 Word/PDF 高级排版（先输出 HTML/Markdown）

---

## 2. 用户旅程与交互设计

### 2.1 用户流程（线性、可控）

1. 进入页面 → 选择参数（场景/文风/字数/受众）
2. 进入访谈：逐题显示（12 问）
3. 每题：输入回答（文字或输入法语音） → AI 判断质量 → 可能追问 → 确认后下一题
4. 完成 12 问 → 一键生成 → 展示四版本结果 → 复制/下载（HTML/Markdown）
5. 可选：一键清除本次内容（隐私）

### 2.2 关键交互约束

* 录音方式：**Push-to-talk**（松手结束）
* 每题音频独立上传，避免大文件失败
* 转写文本必须可编辑（专名/数字纠错）
* 支持“重录本题”“跳过本题”
* 生成阶段显示状态（生成中/完成/失败重试）

---

## 3. 核心功能清单

### 3.1 访谈模块

* 展示问题（Q1–Q12）
* 录音（浏览器 MediaRecorder）
* 音频上传（multipart/form-data）
* 转写结果展示+可编辑
* 本地缓存（LocalStorage）保存每题文本，防刷新丢失（MVP 推荐）

### 3.2 转写模块（STT）

* 接口：`/stt`（n8n Webhook）
* 输入：音频文件 + session_id + question_id
* 输出：transcript + 可选 confidence/segments

### 3.3 结构化抽取（Extractor）

* 接口：`/extract`（n8n Webhook）
* 输入：12 题文本 + 生成参数
* 输出：`summary_json`（固定字段结构）

### 3.4 写稿模块（Writer）

* 接口：`/generate`
* 输入：summary_json + 生成参数
* 输出：四版本文本 `draft_short/draft_main/outline/ppt_outline`

### 3.5 下载/复制

* 复制按钮（每个版本）
* 下载：HTML 或 Markdown 文件（MVP）

---

## 4. 问卷定义（职场通用 12 问）

采用你已确定的 12 问（Q1–Q12），每题对应字段映射由 Extractor 完成。
MVP 要求：Q5–Q7（成果1/2/3）在 UI 上拆成 4 个输入槽更优，但语音版可先用一段语音整体回答 + 转写后手工分段编辑。

---

## 5. 数据结构与契约

### 5.1 Session 对象（前后端统一）

```json
{
  "session_id": "s_xxx",
  "created_at": "ISO8601",
  "params": {
    "audience": "leader|hr|team|public",
    "tone": "plain|official|warm",
    "length_main_chars": 1200
  },
  "answers": {
    "Q1": { "transcript": "", "edited": "", "audio_url": null },
    "Q2": { "transcript": "", "edited": "", "audio_url": null }
  },
  "status": "collecting|ready_to_generate|generating|done|error",
  "outputs": {
    "draft_short": "",
    "draft_main": "",
    "outline": "",
    "ppt_outline": ""
  }
}
```

### 5.2 年终总结结构化 JSON（summary_json）

使用你已定义的 `YearEndSummary` schema（v1.0）。
要求：缺信息填 `null` 或空数组，不得编造。

---

## 6. API 规格（MVP）

### 6.1 POST `/stt`

用途：音频 → 转写
请求（multipart/form-data）：

* `session_id` string
* `question_id` string (Q1..Q12)
* `file` audio blob

响应：

```json
{
  "session_id": "s_xxx",
  "question_id": "Q5",
  "transcript": "……"
}
```

### 6.2 POST `/submit`

用途：提交 12 题最终文本（编辑后）
请求（json）：

```json
{
  "session_id": "s_xxx",
  "params": { "audience": "leader", "tone": "plain", "length_main_chars": 1200 },
  "answers": { "Q1": "…", "Q2": "…", "...": "…" }
}
```

响应：

```json
{ "session_id": "s_xxx", "status": "ready_to_generate" }
```

### 6.3 POST `/generate`

用途：结构化抽取 + 写稿（可合并为一个接口，MVP 推荐合并）
请求：

```json
{
  "session_id": "s_xxx",
  "params": { "audience": "leader", "tone": "plain", "length_main_chars": 1200 },
  "answers": { "Q1": "…", "Q2": "…", "...": "…" }
}
```

响应：

```json
{
  "session_id": "s_xxx",
  "summary_json": { "...": "..." },
  "outputs": {
    "draft_short": "…",
    "draft_main": "…",
    "outline": "…",
    "ppt_outline": "…"
  }
}
```

---

## 7. n8n 工作流规格（MVP 三条）

### 7.1 Workflow A：STT 转写（/stt）

节点：

1. Webhook `/stt`（接收 binary）
2. HTTP Request → STT 服务（Whisper）
3. Respond to Webhook（返回 transcript）

失败策略：

* STT 失败返回 `error` 字段，前端提示“重录/重试”

### 7.2 Workflow B：抽取结构化（Extractor）

节点：

1. Webhook `/extract` 或作为 generate 子流程
2. LLM Node（Extractor prompt）
3. Respond：返回 `summary_json` + `missing_fields`（可选）

### 7.3 Workflow C：写稿生成（Writer）

节点：

1. 接收 summary_json + params
2. LLM Node（Writer prompt）
3. Respond：四版本文本

> MVP 推荐把 B+C 合并成 `/generate` 一个 Webhook，减少前端复杂度。

---

## 8. Prompt 规范（关键质量控制）

### 8.1 Extractor Prompt（强约束）

目标：把 answers 映射到固定 schema（YearEndSummary），并输出缺口清单。
硬规则：

* **只输出 JSON**（不带解释）
* **事实不得脑补**：数字/奖项/时间/人名/机构名若未提供，写 `null` 或 `【待补充】`（按你的策略）
* 把 Q5–Q7 尽量拆成 actions/results/evidence

输出：

```json
{
  "summary_json": { ...YearEndSummary... },
  "missing": [
    { "path": "highlights[0].evidence.metrics", "reason": "缺少可验证证据" }
  ]
}
```

### 8.2 Writer Prompt（反编造 + 反套话）

输入：summary_json + params
硬规则：

* **不得生成 summary_json 不包含的具体事实/数字/荣誉**
* 缺口必须用 `【待补充】` 标记
* 输出四个字段：draft_short / draft_main / outline / ppt_outline
* 压制套话：少用“积极、认真、显著提升”等无证据词

---

## 9. 质量与停止规则（MVP 先不追问，但要“可提示”）

MVP 不做动态追问，但可以在生成结果旁提示：

* “成果1缺少证据，建议补：数据/案例/反馈”
* “反思太空泛，建议补：具体改进行动”

后续版本再引入一轮追问（每题最多一次，全局最多三次）。

---

## 10. 隐私与安全（必须写清）

* 默认不长期保存音频（可配置：只存文本）
* 提供“一键清除本次会话数据”按钮
* API 传输 HTTPS
* 不在输出中泄露密钥/内部链接
* 日志中脱敏（不记录音频内容）

---

## 11. 技术栈建议（适配 Vibe Coding）

### 前端（极简）

* 单页：Vanilla JS / React 均可（MVP 建议先 Vanilla）
* 录音：MediaRecorder
* 存储：LocalStorage（answers 缓存）

### 编排/后端

* n8n：Webhook + HTTP + LLM
* 存储（可选）：Postgres（n8n 自带或外部）

### STT

* MVP：Whisper API（最快）
* 进阶：自建 faster-whisper（降成本）

---

## 12. 里程碑与验收标准

### M1（当天可完成）：STT 通路

验收：

* curl 上传音频 → 返回中文 transcript

### M2（1–2 天）：前端录音+逐题转写

验收：

* 浏览器按住说话 → 显示 transcript → 可编辑保存 → 下一题

### M3（再 1 天）：一键生成四版本

验收：

* 提交 12 题文本 → 返回四版本文本
* 不编造数字：缺的显示【待补充】

### M4（可选）：导出 HTML/Markdown

验收：

* 点击下载得到文件，可直接复制到 Word/飞书

---

## 13. Vibe Coding 使用方式（怎么让 AI 写得更稳）

你把开发任务拆成“可验证的小块”，每块都给 AI 明确输入输出契约：

1. 生成前端录音组件（含上传、错误处理）
2. 生成 session/answers 的本地缓存逻辑
3. 生成 n8n Webhook 入参格式与返回格式
4. 生成 Extractor/Writer 的 prompt（严格 JSON 输出）

每次只要一个可运行模块，跑通再加下一块。

- 