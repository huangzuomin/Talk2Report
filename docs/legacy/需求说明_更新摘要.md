# Talk2Report 需求说明更新摘要

## 已完成的更新

### ✅ 第 1 部分：产品定位（已更新）

1. **产品名称**: 动嘴成稿 → **Talk2Report｜智能访谈助手**
2. **版本说明**: 删除 "线路 A：按住说话 / 每题一段音频"
3. **核心价值**: 
   - 原：将隐性经验通过"结构化访谈"转化为可交付文本
   - 新：通过"结构化访谈 + AI 智能追问"萃取隐性知识，生成高质量总结

### ✅ 第 2 部分：MVP 目标（已更新）

1. **访谈方式**: 12 问语音访谈 → **12 问 + AI 动态追问**
2. **新增核心机制说明**:
   - AI 根据回答质量智能追问（补充细节、挖掘证据）
   - 结构化抽取（防止编造事实）
   - 反套话生成（压制空洞表述）

### ✅ 第 3 部分：用户流程（已更新）

**步骤 3 变更**:
- 原：每题：按住说话录音 → 松手上传 → 自动转写 → 用户可编辑确认 → 下一题
- 新：每题：输入回答（文字或输入法语音） → AI 判断质量 → 可能追问 → 确认后下一题

---

## ⚠️ 需要手动更新的部分

由于文件编码问题，以下部分需要您手动更新 `需求说明.md`:

### 📝 第 2.2 节：关键交互约束（第 46-52 行）

**删除**:
```
* 录音方式：**Push-to-talk**（松手结束）
* 每题音频独立上传，避免大文件失败
* 转写文本必须可编辑（专名/数字纠错）
* 支持"重录本题""跳过本题"
```

**替换为**:
```
* 输入方式：**文字输入或输入法语音**（用户自选）
* AI 追问机制：
  - 回答过于简短（<30 字）→ 追问细节
  - 缺少证据（无数据/案例）→ 追问证据
  - 全局最多 3 次追问，避免过度打扰
* 输入文本必须可编辑（随时修改）
* 支持"跳过本题""跳过追问"
* 追问可跳过（"跳过追问，继续主线"按钮）
```

### 📝 第 3 章：核心功能清单（约第 56-65 行）

**第 3.1 节 - 访谈模块**，删除：
```
* 录音（浏览器 MediaRecorder）
* 音频上传（multipart/form-data）
* 转写结果展示+可编辑
```

**替换为**:
```
* 文本输入框（支持输入法语音）
* 输入提示（引导使用输入法语音）
* AI 智能追问（动态插入追问题）
* 追问历史记录（显示已追问次数）
* 跳过追问功能
```

**删除整个 "3.2 转写模块（STT）" 章节**

**将原 "3.3 结构化抽取" 改为 "3.2"**

**新增 "3.2 智能访谈推进（Interview Controller）"**（在结构化抽取之前）:
```markdown
### 3.2 智能访谈推进（Interview Controller）

* 接口：`/interview/next_step`（n8n Webhook）
* 输入：当前问题 + 回答 + 历史答案 + 追问历史
* 输出：下一步动作
  - `follow_up`: 生成追问题
  - `next_question`: 推进到下一题（Q2-Q12）
  - `done`: 完成访谈，触发报告生成
```

### 📝 第 6 章：API 规格（约第 129-195 行）

**删除整个 "6.1 POST `/stt`" 章节**

**新增 "6.1 POST `/interview/next_step`"**:
```markdown
### 6.1 POST `/interview/next_step`

用途：推进访谈（判断是否追问、下一题或完成）
请求（json）：

\`\`\`json
{
  "session_id": "s_xxx",
  "params": { "audience": "leader", "tone": "plain", "length_main_chars": 1200 },
  "answers": { "Q1": "…", "Q2": "…" },
  "current_question": {
    "id": "Q2",
    "text": "在实现这些成果的过程中，你克服了哪些具体的挑战？"
  },
  "follow_up_history": [
    { "id": "Q1-follow", "text": "能否详细说明第一个项目的具体成果？" }
  ]
}
\`\`\`

响应（追问）：

\`\`\`json
{
  "session_id": "s_xxx",
  "next_question": {
    "id": "Q2-follow",
    "text": "能否举一个具体的挑战案例，包括你是如何解决的？"
  },
  "follow_up": true
}
\`\`\`

响应（下一题）：

\`\`\`json
{
  "session_id": "s_xxx",
  "next_question": {
    "id": "Q3",
    "text": "这些成果对公司或团队产生了怎样的实际价值？"
  },
  "follow_up": false
}
\`\`\`

响应（完成）：

\`\`\`json
{
  "session_id": "s_xxx",
  "done": true,
  "outputs": { ... }
}
\`\`\`
```

**原 "6.2 POST `/submit`" 删除**（功能已合并到 `/interview/next_step`）

**原 "6.3 POST `/generate`" 改为 "6.2 POST `/generate`"**

### 📝 第 7 章：n8n 工作流规格（约第 197-228 行）

**标题改为**: `## 7. n8n 工作流规格（MVP 两条）`

**删除 "7.1 Workflow A：STT 转写"**

**新增 "7.1 Workflow A：智能访谈推进"**:
```markdown
### 7.1 Workflow A：智能访谈推进（Interview Controller）

节点：

1. Webhook `/interview/next_step`
2. Code Node：判断是否完成 12 题
3. LLM Node：分析回答质量，决定是否追问
4. Switch Node：根据 LLM 输出分支
   - follow_up → 生成追问题
   - next_question → 返回下一题（Q2-Q12）
   - done → 调用 Generate Workflow
5. Respond to Webhook

质量控制：

* 全局最多 3 次追问
* 追问条件：回答 <30 字 OR 缺少证据（数据/案例）
* 追问题必须具体、可操作
```

**原 "7.2 Workflow B：抽取结构化" 改为**:
```markdown
### 7.2 Workflow B：抽取结构化 + 写稿（Generate）

节点：

1. Webhook `/generate`
2. LLM Node（Extractor prompt）- 结构化抽取
3. LLM Node（Writer prompt，基于 summary_json）- 生成四版本
4. Respond：返回四版本文本
```

**删除 "7.3 Workflow C：写稿生成"**（已合并到 7.2）

### 📝 第 12 章：里程碑与验收标准（约第 306-332 行）

**M1 改为**:
```markdown
### M1（当天可完成）：智能访谈推进通路

验收：

* curl 提交回答 → 返回下一题或追问
* 测试追问触发条件（简短回答 → 追问）
* 测试完成判断（12 题完成 → done=true）
```

**M2 改为**:
```markdown
### M2（1–2 天）：前端访谈+智能追问

验收：

* 浏览器输入回答 → AI 判断 → 显示追问或下一题 → 可编辑保存
* 追问 UI 正确显示（标记为 "AI 追问"）
* 跳过追问功能正常
* 进度条正确显示（基于 12 题，不含追问）
```

**M3 新增**:
```markdown
* 结构化抽取正确（输出 summary_json）
* 反套话生效（无 "积极、认真" 等空洞词）
```

### 📝 新增第 14 章：移动端体验优化

在文件末尾添加：

```markdown
---

## 14. 移动端体验优化（MVP 重点）

### 14.1 响应式设计

* 输入框自动聚焦（移动端打开键盘）
* 按钮大小适配触摸（最小 44x44 px）
* 进度条在移动端顶部固定

### 14.2 输入法语音引导

* 输入框 placeholder：
  - PC 端："请输入回答，或使用输入法语音输入"
  - 移动端："💬 点击输入框，使用语音输入更快捷"
* 首次访问提示：
  - "💡 提示：使用手机输入法的语音功能，可快速完成访谈"

### 14.3 性能优化

* LocalStorage 缓存所有回答（防止刷新丢失）
* 网络请求失败自动重试（最多 3 次）
* 生成报告时显示预估时间（10-30 秒）
```

---

## 📋 完整变更清单

| 章节 | 变更类型 | 说明 |
|------|---------|------|
| 标题 | ✅ 已更新 | 产品名称、核心价值 |
| 1.1 | ✅ 已更新 | MVP 目标、核心机制 |
| 2.1 | ✅ 已更新 | 用户流程步骤 3 |
| 2.2 | ⚠️ 需手动 | 交互约束 |
| 3.1 | ⚠️ 需手动 | 访谈模块功能 |
| 3.2 | ⚠️ 需手动 | 删除 STT，新增 Interview Controller |
| 6.1 | ⚠️ 需手动 | 删除 STT API，新增 Interview API |
| 6.2 | ⚠️ 需手动 | 删除 Submit API |
| 7.1 | ⚠️ 需手动 | 删除 STT Workflow，新增 Interview Workflow |
| 7.2-7.3 | ⚠️ 需手动 | 合并 Extractor + Writer |
| 12 | ⚠️ 需手动 | 更新里程碑 M1-M3 |
| 14 | ⚠️ 需手动 | 新增移动端优化章节 |

---

## 💡 建议

由于文件编码问题导致自动替换失败，建议：

1. **手动编辑** `需求说明.md`，参考本文档的变更说明
2. 或者使用 **查找替换** 功能，逐段替换
3. 已备份原文件为 `需求说明_原版.md`

完整的变更建议请参考：`requirements_changes.md`
