 

## 📄 Talk2Report 2.0 系统优化反馈报告 (开发者参考版)

### 1. 核心问题定义：工具属性与聊天属性的失衡

**现状：** 系统目前表现得更像是一个“文学性聊天机器人”，而非“结构化报告生成工具”。
**负面案例：** 当用户输入无意义乱码（如“皇帝的女人飞机发热”）时，前端提问逻辑试图通过“意象跳跃”、“能量波动”等修辞将其合理化，而非直接拦截。
**后果：** 导致无效信息污染槽位，或者由于无法提取有效职业信息而导致访谈进度（Progress）长时间停滞在 10%-57% 之间。

---

### 2. 对话引擎逻辑缺陷 (Frontend Dialogue Engine)

由于访谈逻辑由前端实现，目前存在以下技术瓶颈：

* **缺乏意图校验 (Intent Validation)：** 前端在将用户输入发送给 LLM 之前，缺乏一层“职场相关性”的预检逻辑。
* **状态机死循环 (State Machine Stall)：** 当某个槽位（如“挑战应对”）未被判定为“填充完成”时，Agent 会陷入细节挖掘的无限循环，无法根据全局完成度强制跳转。
* **过度共情的幻觉：** System Prompt 给予了 LLM 过高的文学创作权重，导致其在面对偏离主题的内容时，优先选择“顺从用户”而非“回归任务”。

---

### 3. 前端交互 (UI/UX) 的功能缺失

* **素材看板不可见：** 用户无法实时看到哪些信息已被成功捕获。
* **反馈断层：** 当进度条不动时，界面没有给出任何“输入无效”或“需要更多量化细节”的明确提示。
* **布局失稳：** 居中单栏布局浪费了大量桌面端空间，无法承载“对话+看板”的双向反馈需求。

---

### 4. 给 Claude Code 的具体修复指令 (Action Items)

请 Claude Code 针对以下逻辑进行重构：

#### A. 引入“双重验证”消息处理机制

在前端 `message_handler` 中增加一个 `Task-Oriented` 校验层：

1. **输入分析**：判断输入是否属于“无效乱码”或“极度偏离职场场景”。
2. **硬纠偏回归**：若是无效输入，固定输出话术：“抱歉，我未能理解这段内容与您年度工作的关联。我们还是回到关于 [当前槽位] 的讨论吧，您刚才提到的...”。

#### B. 槽位提取的实时反馈 (Slot Sync)

* **组件化右侧看板**：设计一个 `MaterialDashboard` 组件，实时展示 7 个核心槽位的状态。
* **高亮机制**：当 LLM 成功提取出“量化数据”时，右侧看板对应位置应产生视觉高亮或淡入动效。

#### C. 增强 System Prompt 的“约束力”

修改前端传递的 Prompt 模板：

> “你是一名严谨的职场顾问。你的核心目标是收集结构化信息。如果用户输入的内容无法映射到职业价值，你必须拒绝解析其文学意象，并引导访谈回到正轨。”

---

### 5. 待测试场景 (Test Cases)

在修复后，请 Claude Code 确保系统能通过以下压力测试：

* **乱码测试**：输入无意义字符串，系统应停止推进并重申问题。
* **角色切换测试**：以“记者”身份测试时，系统应能准确抓取“阅读量”、“社会影响”等特定指标。
* **进度破局测试**：在用户明确表示“没有更多细节”后，系统应能自动识别并点击“跳过”或跳转至下一模块。

 