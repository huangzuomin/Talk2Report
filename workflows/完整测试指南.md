# n8n å·¥ä½œæµæµ‹è¯•å®Œæ•´æŒ‡å—

## ğŸ“‹ å‰ç½®å‡†å¤‡

### 1. ç¡®è®¤å·¥ä½œæµå·²å¯¼å…¥

1. ç™»å½• n8n: `https://n8n.neican.ai`
2. å¯¼å…¥å·¥ä½œæµ: `n8n_generate_workflow_v2_n8n2_compatible.json`
3. æ£€æŸ¥èŠ‚ç‚¹é…ç½®:
   - âœ… Webhook èŠ‚ç‚¹è·¯å¾„: `/generate`
   - âœ… OpenAI å‡­è¯å·²é…ç½®ï¼ˆç¡…åŸºæµåŠ¨ï¼‰
   - âœ… Header Auth å·²å¯ç”¨

### 2. æ¿€æ´»å·¥ä½œæµ

1. ç‚¹å‡»å³ä¸Šè§’ "Inactive" åˆ‡æ¢ä¸º "Active"
2. ç¡®è®¤ Webhook URL æ˜¾ç¤ºä¸º: `https://n8n.neican.ai/webhook/generate`

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æ–¹æ³• 1: ä½¿ç”¨ n8n å†…ç½®æµ‹è¯•ï¼ˆæœ€ç®€å•ï¼‰

#### æ­¥éª¤ 1: æ‰“å¼€ Webhook èŠ‚ç‚¹

1. åŒå‡» "Webhook - Generate" èŠ‚ç‚¹
2. ç‚¹å‡» "Listen for Test Event" æŒ‰é’®
3. å¤åˆ¶æ˜¾ç¤ºçš„æµ‹è¯• URL

#### æ­¥éª¤ 2: å‘é€æµ‹è¯•è¯·æ±‚

ä½¿ç”¨ PowerShell æˆ– curl:

```powershell
# PowerShell
$body = Get-Content "r:\Talk2Report\å·¥ä½œæµ\æµ‹è¯•æ•°æ®_å·¥ä½œæ€»ç»“ç”Ÿæˆ.json" -Raw
$headers = @{
    "Content-Type" = "application/json"
    "Authorization" = "Bearer YOUR_TOKEN_HERE"
}

Invoke-RestMethod -Uri "https://n8n.neican.ai/webhook-test/generate" `
    -Method POST `
    -Headers $headers `
    -Body $body
```

#### æ­¥éª¤ 3: æŸ¥çœ‹æ‰§è¡Œç»“æœ

1. n8n ä¼šè‡ªåŠ¨æ˜¾ç¤ºæ‰§è¡Œæµç¨‹
2. ç‚¹å‡»æ¯ä¸ªèŠ‚ç‚¹æŸ¥çœ‹è¾“å…¥/è¾“å‡º
3. æ£€æŸ¥æœ€ç»ˆå“åº”

---

### æ–¹æ³• 2: ä½¿ç”¨ç”Ÿäº§ Webhookï¼ˆå®Œæ•´æµ‹è¯•ï¼‰

#### æ­¥éª¤ 1: å‡†å¤‡æµ‹è¯•è„šæœ¬

åˆ›å»º `test-workflow.ps1`:

```powershell
# è¯»å–æµ‹è¯•æ•°æ®
$testData = Get-Content "r:\Talk2Report\å·¥ä½œæµ\æµ‹è¯•æ•°æ®_å·¥ä½œæ€»ç»“ç”Ÿæˆ.json" -Raw | ConvertFrom-Json

# é…ç½®
$webhookUrl = "https://n8n.neican.ai/webhook/generate"
$authToken = "YOUR_ACTUAL_TOKEN_HERE"

# å‘é€è¯·æ±‚
$headers = @{
    "Content-Type" = "application/json"
    "Authorization" = "Bearer $authToken"
}

Write-Host "ğŸ“¤ å‘é€æµ‹è¯•è¯·æ±‚..." -ForegroundColor Cyan
$response = Invoke-RestMethod -Uri $webhookUrl `
    -Method POST `
    -Headers $headers `
    -Body ($testData | ConvertTo-Json -Depth 10)

# æ˜¾ç¤ºç»“æœ
Write-Host "âœ… è¯·æ±‚æˆåŠŸï¼" -ForegroundColor Green
Write-Host "`nğŸ“Š å“åº”æ•°æ®:" -ForegroundColor Yellow
$response | ConvertTo-Json -Depth 10 | Write-Host

# ä¿å­˜ç»“æœ
$response | ConvertTo-Json -Depth 10 | Out-File "test-result.json"
Write-Host "`nğŸ’¾ ç»“æœå·²ä¿å­˜åˆ° test-result.json" -ForegroundColor Green
```

#### æ­¥éª¤ 2: è¿è¡Œæµ‹è¯•

```powershell
cd r:\Talk2Report\å·¥ä½œæµ
.\test-workflow.ps1
```

---

### æ–¹æ³• 3: ä½¿ç”¨ curlï¼ˆè·¨å¹³å°ï¼‰

```bash
curl -X POST https://n8n.neican.ai/webhook/generate \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -d @æµ‹è¯•æ•°æ®_å·¥ä½œæ€»ç»“ç”Ÿæˆ.json \
  --output test-result.json \
  --verbose
```

---

## ğŸ” éªŒè¯æµ‹è¯•ç»“æœ

### 1. æ£€æŸ¥å“åº”ç»“æ„

å“åº”åº”åŒ…å«ä»¥ä¸‹å­—æ®µ:

```json
{
  "session_id": "test-session-2025-12-28-001",
  "summary_json": {
    "basic_info": { ... },
    "highlights": [ ... ],
    "challenges": [ ... ],
    "growth": { ... },
    "contributions": { ... },
    "future": { ... },
    "keywords": [ ... ]
  },
  "outputs": {
    "draft_short": "200å­—ç²¾ç®€ç‰ˆ...",
    "draft_main": "800-1500å­—æ­£å¼ç¨¿...",
    "outline": "ç»“æ„åŒ–å¤§çº²...",
    "ppt_outline": "PPT æçº²..."
  }
}
```

### 2. è´¨é‡æ£€æŸ¥æ¸…å•

#### Extractor è¾“å‡ºï¼ˆsummary_jsonï¼‰

- [ ] **æ•°å­—åŸæ–‡å¼•ç”¨**: æ£€æŸ¥ "800msé™è‡³200ms"ã€"50%" ç­‰æ˜¯å¦æ¥è‡ªæµ‹è¯•æ•°æ®
- [ ] **æ— ç¼–é€ ä¿¡æ¯**: ç¡®è®¤æ²¡æœ‰æµ‹è¯•æ•°æ®ä¸­ä¸å­˜åœ¨çš„å†…å®¹
- [ ] **ç»“æ„å®Œæ•´**: æ‰€æœ‰å¿…éœ€å­—æ®µéƒ½å­˜åœ¨
- [ ] **ç±»å‹æ­£ç¡®**: æ•°ç»„æ˜¯æ•°ç»„ï¼Œå¯¹è±¡æ˜¯å¯¹è±¡

#### Writer è¾“å‡ºï¼ˆoutputsï¼‰

- [ ] **draft_short**: çº¦ 200 å­—ï¼ŒåŒ…å«å…³é”®æˆæœå’Œæ•°æ®
- [ ] **draft_main**: 800-1500 å­—ï¼Œç»“æ„æ¸…æ™°
- [ ] **æ— å¥—è¯**: æ²¡æœ‰ "ç§¯æã€è®¤çœŸã€æ˜¾è‘—æå‡" ç­‰ç©ºæ´è¯æ±‡
- [ ] **æœ‰å…·ä½“æ•°æ®**: åŒ…å« "800msâ†’200ms"ã€"50%" ç­‰å…·ä½“æŒ‡æ ‡
- [ ] **outline**: Markdown æ ¼å¼ï¼Œå±‚çº§æ¸…æ™°
- [ ] **ppt_outline**: 10 é¡µä»¥å†…ï¼Œæ¯é¡µæœ‰æ ‡é¢˜å’Œè¦ç‚¹

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: 401 Unauthorized

**åŸå› **: Token é”™è¯¯æˆ–æœªé…ç½®

**è§£å†³**:
1. æ£€æŸ¥ n8n Webhook èŠ‚ç‚¹çš„ Header Auth é…ç½®
2. ç¡®è®¤æµ‹è¯•è„šæœ¬ä¸­çš„ Token ä¸ n8n é…ç½®ä¸€è‡´
3. Token æ ¼å¼: `Bearer YOUR_TOKEN`

### é—®é¢˜ 2: 404 Not Found

**åŸå› **: Webhook è·¯å¾„é”™è¯¯æˆ–å·¥ä½œæµæœªæ¿€æ´»

**è§£å†³**:
1. ç¡®è®¤å·¥ä½œæµçŠ¶æ€ä¸º "Active"
2. æ£€æŸ¥ Webhook è·¯å¾„: `/generate`
3. å®Œæ•´ URL: `https://n8n.neican.ai/webhook/generate`

### é—®é¢˜ 3: 500 Internal Server Error

**åŸå› **: LLM è°ƒç”¨å¤±è´¥æˆ– JSON è§£æé”™è¯¯

**è§£å†³**:
1. åœ¨ n8n ä¸­æŸ¥çœ‹æ‰§è¡Œå†å²
2. æ£€æŸ¥å“ªä¸ªèŠ‚ç‚¹å¤±è´¥
3. æŸ¥çœ‹èŠ‚ç‚¹é”™è¯¯ä¿¡æ¯
4. å¸¸è§åŸå› :
   - ç¡…åŸºæµåŠ¨ API Key æ— æ•ˆ
   - LLM è¾“å‡ºæ ¼å¼é”™è¯¯
   - JSON è§£æå¤±è´¥

### é—®é¢˜ 4: å“åº”æ—¶é—´è¿‡é•¿ï¼ˆ>60sï¼‰

**åŸå› **: LLM ç”Ÿæˆæ—¶é—´é•¿

**è§£å†³**:
1. æ­£å¸¸æƒ…å†µ: 20-40 ç§’
2. å¦‚æœè¶…è¿‡ 60 ç§’ï¼Œæ£€æŸ¥:
   - ç¡…åŸºæµåŠ¨ API çŠ¶æ€
   - ç½‘ç»œè¿æ¥
   - LLM æ¨¡å‹è´Ÿè½½

---

## ğŸ“Š æŸ¥çœ‹æ‰§è¡Œå†å²

### åœ¨ n8n ä¸­æŸ¥çœ‹

1. ç‚¹å‡»å·¦ä¾§èœå• "Executions"
2. æ‰¾åˆ°æœ€è¿‘çš„æ‰§è¡Œè®°å½•
3. ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
4. æ£€æŸ¥æ¯ä¸ªèŠ‚ç‚¹çš„è¾“å…¥/è¾“å‡º

### å…³é”®èŠ‚ç‚¹æ£€æŸ¥

#### 1. Set Variables
- è¾“å…¥: Webhook body
- è¾“å‡º: session_id, answers, params

#### 2. Extractor Agent
- è¾“å…¥: answers (æµ‹è¯•æ•°æ®)
- è¾“å‡º: summary_json (ç»“æ„åŒ–æ•°æ®)
- **æ£€æŸ¥**: JSON æ ¼å¼æ˜¯å¦æ­£ç¡®

#### 3. Prepare Writer Input
- è¾“å…¥: Extractor è¾“å‡º
- è¾“å‡º: summary_json + params
- **æ£€æŸ¥**: æ•°æ®æ˜¯å¦æ­£ç¡®ä¼ é€’

#### 4. Writer Agent
- è¾“å…¥: summary_json + params
- è¾“å‡º: å››ç‰ˆæœ¬æ–‡æœ¬
- **æ£€æŸ¥**: æ–‡æœ¬è´¨é‡

---

## ğŸ¯ æ€§èƒ½åŸºå‡†

| æŒ‡æ ‡ | é¢„æœŸå€¼ | è¯´æ˜ |
|------|--------|------|
| æ€»å“åº”æ—¶é—´ | 20-40s | Extractor + Writer ä¸¤æ¬¡ LLM è°ƒç”¨ |
| Extractor æ—¶é—´ | 8-15s | ç»“æ„åŒ–æŠ½å– |
| Writer æ—¶é—´ | 12-25s | ç”Ÿæˆå››ç‰ˆæœ¬ |
| æˆåŠŸç‡ | >95% | JSON Mode ç¡®ä¿æ ¼å¼æ­£ç¡® |

---

## ğŸ”„ æ‰¹é‡æµ‹è¯•

### åˆ›å»ºå¤šä¸ªæµ‹è¯•ç”¨ä¾‹

```powershell
# test-batch.ps1
$testCases = @(
    "æµ‹è¯•æ•°æ®_å·¥ä½œæ€»ç»“ç”Ÿæˆ.json",
    "æµ‹è¯•æ•°æ®_ç®€çŸ­ç‰ˆ.json",
    "æµ‹è¯•æ•°æ®_è¯¦ç»†ç‰ˆ.json"
)

foreach ($testFile in $testCases) {
    Write-Host "`nğŸ§ª æµ‹è¯•: $testFile" -ForegroundColor Cyan
    
    $body = Get-Content $testFile -Raw
    $response = Invoke-RestMethod `
        -Uri "https://n8n.neican.ai/webhook/generate" `
        -Method POST `
        -Headers @{
            "Content-Type" = "application/json"
            "Authorization" = "Bearer YOUR_TOKEN"
        } `
        -Body $body
    
    # ä¿å­˜ç»“æœ
    $resultFile = $testFile -replace ".json", "-result.json"
    $response | ConvertTo-Json -Depth 10 | Out-File $resultFile
    
    Write-Host "âœ… å®Œæˆ: $resultFile" -ForegroundColor Green
}
```

---

## ğŸ“ æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

### æ‰§è¡Œæµ‹è¯•åå¡«å†™

```markdown
# å·¥ä½œæµæµ‹è¯•æŠ¥å‘Š

**æµ‹è¯•æ—¶é—´**: 2025-12-28 22:35
**æµ‹è¯•äºº**: [ä½ çš„åå­—]
**å·¥ä½œæµç‰ˆæœ¬**: v2 (n8n 2.0 compatible)

## æµ‹è¯•ç»“æœ

### åŸºæœ¬åŠŸèƒ½
- [ ] Webhook æ¥æ”¶æ­£å¸¸
- [ ] Extractor è¾“å‡ºæ­£ç¡®
- [ ] Writer ç”ŸæˆæˆåŠŸ
- [ ] å“åº”æ ¼å¼æ­£ç¡®

### è´¨é‡æ£€æŸ¥
- [ ] æ— ç¼–é€ ä¿¡æ¯
- [ ] æ•°å­—åŸæ–‡å¼•ç”¨
- [ ] æ— å¥—è¯
- [ ] å­—æ•°ç¬¦åˆè¦æ±‚

### æ€§èƒ½æŒ‡æ ‡
- æ€»å“åº”æ—¶é—´: ___ ç§’
- Extractor æ—¶é—´: ___ ç§’
- Writer æ—¶é—´: ___ ç§’

### é—®é¢˜è®°å½•
1. [é—®é¢˜æè¿°]
   - è§£å†³æ–¹æ¡ˆ: [...]

## ç»“è®º
- [ ] æµ‹è¯•é€šè¿‡ï¼Œå¯ä»¥éƒ¨ç½²
- [ ] éœ€è¦ä¼˜åŒ–: [...]
```

---

## ğŸš€ ä¸‹ä¸€æ­¥

æµ‹è¯•é€šè¿‡å:

1. **æ›´æ–°å‰ç«¯é…ç½®**
   ```bash
   # .env.local
   VITE_N8N_GENERATE_URL=https://n8n.neican.ai/webhook/generate
   ```

2. **ç«¯åˆ°ç«¯æµ‹è¯•**
   - åœ¨å‰ç«¯å®Œæˆå®Œæ•´è®¿è°ˆæµç¨‹
   - ç‚¹å‡» "ä¸€é”®ç”ŸæˆæŠ¥å‘Š"
   - éªŒè¯å››ä¸ªç‰ˆæœ¬çš„è´¨é‡

3. **éƒ¨ç½²åˆ°ç”Ÿäº§**
   - é…ç½® Vercel ç¯å¢ƒå˜é‡
   - éƒ¨ç½²å‰ç«¯
   - å®Œæ•´æµ‹è¯•

---

**ç°åœ¨å°±å¯ä»¥å¼€å§‹æµ‹è¯•äº†ï¼å»ºè®®ä»æ–¹æ³• 1ï¼ˆn8n å†…ç½®æµ‹è¯•ï¼‰å¼€å§‹ã€‚**
