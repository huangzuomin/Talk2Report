# n8n Workflows

æœ¬ç›®å½•åŒ…å« Talk2Report 2.0 çš„ n8n å¤šæ™ºèƒ½ä½“å·¥ä½œæµé…ç½®ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
n8n_workflows/
â”œâ”€â”€ interview_workflow.json          # Agent A: Interviewer å·¥ä½œæµ
â”œâ”€â”€ generate_workflow.json           # Agent B+C+D: Generate å·¥ä½œæµ
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ test_workflows.js            # å·¥ä½œæµæµ‹è¯•è„šæœ¬
â””â”€â”€ README.md                        # æœ¬æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯¼å…¥å·¥ä½œæµåˆ° n8n

- æ–¹æ³• 1: é€šè¿‡ n8n UI å¯¼å…¥ JSON æ–‡ä»¶
- æ–¹æ³• 2: ä½¿ç”¨ REST API å¯¼å…¥

è¯¦è§: [éƒ¨ç½²æŒ‡å—](../docs/N8N_DEPLOYMENT_GUIDE.md)

### 2. é…ç½® DeepSeek API

åœ¨ n8n ä¸­åˆ›å»º Credential:
- ç±»å‹: Header Auth
- Name: `Authorization`
- Value: `Bearer sk-YOUR_DEEPSEEK_API_KEY`

### 3. æµ‹è¯•å·¥ä½œæµ

```bash
# å®‰è£…ä¾èµ– (node-fetch)
npm install

# è¿è¡Œæµ‹è¯•
node tests/test_workflows.js
```

## ğŸ“‹ å·¥ä½œæµè¯´æ˜

### Interview Workflow (Agent A)

**Webhook**: `/webhook/interview/next-step`

**åŠŸèƒ½**: é€šè¿‡è‹æ ¼æ‹‰åº•å¼æé—®æ”¶é›†ç”¨æˆ·çš„å¹´åº¦å·¥ä½œç»å†

**æµç¨‹**:
1. æ¥æ”¶ç”¨æˆ·å›ç­”
2. è°ƒç”¨ DeepSeek Reasoner
3. æå–å…³é”®ä¿¡æ¯
4. æ›´æ–°æ§½ä½çŠ¶æ€
5. è¿”å›ä¸‹ä¸€ä¸ªé—®é¢˜

**è¯·æ±‚**:
```json
{
  "session_id": "uuid",
  "user_answer": "ç”¨æˆ·çš„å›ç­”",
  "current_state": {
    "slots": [...],
    "completion_rate": 0.3
  }
}
```

**å“åº”**:
```json
{
  "question": "ä¸‹ä¸€ä¸ªé—®é¢˜",
  "thinking": "AIæ€è€ƒè¿‡ç¨‹",
  "extracted_info": {...},
  "updated_state": {...}
}
```

### Generate Workflow (Agent B+C+D)

**Webhook**: `/webhook/generate`

**åŠŸèƒ½**: ä»å¯¹è¯å†å²ç”Ÿæˆå¤šç‰ˆæœ¬çš„å¹´ç»ˆæ€»ç»“æŠ¥å‘Š

**æµç¨‹**:
1. Agent B æå–ç»“æ„åŒ–æ•°æ®
2. Agent C å¹¶è¡Œç”Ÿæˆ3ä¸ªç‰ˆæœ¬
3. Agent D éªŒè¯è´¨é‡
4. è´¨é‡é—­ç¯ (å¦‚éœ€è¦)
5. è¿”å›æœ€ç»ˆæŠ¥å‘Š

**è¯·æ±‚**:
```json
{
  "conversation_history": [...],
  "preferences": {
    "role": "å‰ç«¯å·¥ç¨‹å¸ˆ",
    "audience": "leader",
    "tone": "formal",
    "length_main_chars": 1200
  }
}
```

**å“åº”**:
```json
{
  "success": true,
  "iterations": 1,
  "factsheet": {...},
  "versions": [
    {"type": "brief", "content": "..."},
    {"type": "formal", "content": "..."},
    {"type": "social", "content": "..."}
  ],
  "quality": {
    "passed": true,
    "score": 87,
    "verdict": "..."
  }
}
```

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
node tests/test_workflows.js
```

### è¿è¡Œç‰¹å®šæµ‹è¯•
```bash
# æµ‹è¯• Agent A
node tests/test_workflows.js agent-a

# æµ‹è¯•ç”Ÿæˆæµç¨‹
node tests/test_workflows.js generate

# ç«¯åˆ°ç«¯æµ‹è¯•
node tests/test_workflows.js e2e

# æ€§èƒ½æµ‹è¯•
node tests/test_workflows.js perf
```

### ç¯å¢ƒå˜é‡
```bash
export N8N_BASE_URL="https://your-n8n-instance.com"
export N8N_AUTH_TOKEN="your-secret-token"
```

## ğŸ“Š æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Frontend                      â”‚
â”‚              (React + Vite)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              n8n Workflows                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚   Agent A    â”‚  Interviewer                  â”‚
â”‚  â”‚  (è®¿è°ˆ)      â”‚  deepseek-reasoner            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚   Agent B    â”‚  Archivist                    â”‚
â”‚  â”‚  (æå–)      â”‚  deepseek-chat                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚         â”‚                                        â”‚
â”‚         â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚   Agent C    â”‚  Writers (3x å¹¶è¡Œ)            â”‚
â”‚  â”‚  (å†™ä½œ)      â”‚  deepseek-chat                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚         â”‚                                        â”‚
â”‚         â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚   Agent D    â”‚  Critic                       â”‚
â”‚  â”‚  (å®¡æŸ¥)      â”‚  deepseek-reasoner            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚         â”‚                                        â”‚
â”‚         â–¼                                        â”‚
â”‚   [è´¨é‡é—­ç¯ < 80åˆ†] â”€â”€â”                          â”‚
â”‚         â”‚             â”‚                          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [æ¶æ„è®¾è®¡](../docs/N8N_WORKFLOW_ARCHITECTURE.md) - å®Œæ•´çš„æ¶æ„è®¾è®¡
- [éƒ¨ç½²æŒ‡å—](../docs/N8N_DEPLOYMENT_GUIDE.md) - è¯¦ç»†çš„éƒ¨ç½²æ­¥éª¤
- [Phase 3 å®ŒæˆæŠ¥å‘Š](../PHASE3_COMPLETION_REPORT.md) - å®æ–½æ€»ç»“

## ğŸ”§ é…ç½®è¯´æ˜

### DeepSeek API

è·å– API Key: https://platform.deepseek.com/

å®šä»· (2025å¹´1æœˆ):
- deepseek-chat: Â¥1/M tokens (è¾“å…¥), Â¥2/M tokens (è¾“å‡º)
- deepseek-reasoner: Â¥1/M tokens (è¾“å…¥), Â¥2/M tokens (è¾“å‡º)

### æˆæœ¬ä¼°ç®—

æ¯ä»½æŠ¥å‘Š: Â¥0.05-0.07 (~$0.007-0.01)
æœˆåº¦æˆæœ¬ (1000ä»½): Â¥50-70 (~$7-10)

## ğŸ› æ•…éšœæ’é™¤

è¯¦è§: [éƒ¨ç½²æŒ‡å— - æ•…éšœæ’é™¤](../docs/N8N_DEPLOYMENT_GUIDE.md#æ•…éšœæ’é™¤)

å¸¸è§é—®é¢˜:
1. Webhook 404 - æ£€æŸ¥ URL é…ç½®
2. API è°ƒç”¨å¤±è´¥ - éªŒè¯ API Key
3. æ‰§è¡Œè¶…æ—¶ - å¢åŠ è¶…æ—¶æ—¶é—´
4. è´¨é‡è¯„åˆ†ä½ - è°ƒæ•´ Agent prompts

## ğŸ“ License

ä¸ä¸»é¡¹ç›®ç›¸åŒ

---

**æœ€åæ›´æ–°**: 2025-01-03
**ç‰ˆæœ¬**: 2.0-Phase3
